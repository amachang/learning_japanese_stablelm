# ä½œæ¥­ãƒ­ã‚°

- github repo ä½œã£ãŸ
- what i know ãƒ¡ãƒ¢ã‚’ä½œã£ãŸ
- å¿µã®ç‚ºç¢ºèªã—ãŸãŒ ChatGPT ã¯ Stable Diffusion ã‚‚ StableLM ã‚‚ãªã„æ™‚ä»£ã®çŸ¥è­˜ã‚‰ã—ã„
- å„ç¨®å¿…è¦ãªç’°å¢ƒã‚’èª¿ã¹ã‚‹
  - StableLM Instruct ã®æ–¹ã® Huggingface ã®ãƒšãƒ¼ã‚¸ã§ã‚‚èª­ã‚€
- è»½ãã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚„ requirements ã‚’ã¿ã¦ã€æ´¾ç”Ÿçš„ãªçŸ¥è­˜ã‚’å¾—ã‚‹
- huggingface ã®ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’ã–ã£ã¨è¦‹ã‚‹
- æœ€çµ‚çš„ã«ã¯ GKE ã§ä½¿ã†ã¨ãã ã‘ Web UI ã‚’ç«‹ã¡ä¸Šã’ã‚‹ã¿ãŸã„ã«ã—ãŸã„ã‘ã©ã€ä¸€æ—¦æ™®é€šã® Compute Engine ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç«‹ã¦ã‚‹
  - ã©ã®ãã‚‰ã„ã ã‚ã¨ã‚Šã‚ãˆãš T4 / n1-highmem-8 / Ubuntu 22.04 / 100 GB / ã‚¹ãƒãƒƒãƒˆãã‚‰ã„ãªæ„Ÿã˜ã§ã€‚ã“ã†ã„ã†ã¨ã Ubuntu ã˜ã‚ƒãªã„ã»ã†ãŒè‰¯ã„ã‚“ã ã‚ã†ã‹
    - 0.36 USD/hour
      - æ¶ˆã—å¿˜ã‚ŒãŸã‚‰æœˆ 30000 å††ãã‚‰ã„é£›ã¶æ„Ÿã˜ã§
    - æ…£ã‚Œã¦ã‚‹ã£ã¦ç†ç”±ã ã‘ã§ Ubuntu ã ã‘ã©ã€‚ã©ã®ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã«ä½•ãŒå…¥ã£ã¦ã‚‹ã‹å…¨ãçŸ¥ã‚‰ãªã„
  - ã‚¹ãƒãƒƒãƒˆã ã‹ã‚‰åˆ¥ã®ã‚¾ãƒ¼ãƒ³ã˜ã‚ƒãªã„ã¨å€Ÿã‚Šã‚‰ã‚Œãªã„ã‹ãªã¨ã‹ã‚‚æ¤œè¨Žã—ã¦ãŸã‘ã©ã€ã™ã‚“ãªã‚Š instance allocation ã•ã‚ŒãŸ
- Compute Engine ã® instance ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯[scripts/setup\_instance](../scripts/setup_instance)ã«ã¾ã¨ã‚ã¦ã„ã
  - nvidia driver 535
  - cuda 11.8
  - python 3.10
- ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¯ [scripts/setup\_env.sh](../scripts/setup_env.sh)
- instruct ã®æ–¹ã§éŠã‚“ã§ã¿ã‚‹ãŒã€ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’è¦‹ã¦ã€è³ªå•ã‚’ç­”ãˆã‚‹ã“ã¨ãŒãƒ¡ã‚¤ãƒ³ãªæ„Ÿã˜ãŒã—ãŸã€‚ base ã®æ–¹ã§ã¡ã‚‡ã£ã¨éŠã‚“ã§ã¿ã‚‹ã‹ã¨ã„ã†æ„Ÿã˜
  - [stablelm\_sandbox/try\_base\_model.py](../stablelm_sandbox/try_base_model.py)
  - [stablelm\_sandbox/try\_instruct\_model.py](../stablelm_sandbox/try_instruct_model.py)
- [dialog.py](../stablelm_sandbox/dialog.py) ã¨ã„ã†ã®ã‚’ä½œã£ã¦ã¡ã‚‡ã£ã¨éŠã‚“ã§ã¿ãŸã€‚ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®æŠ½å‡ºã¨ã‹ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®æ¸¡ã—æ–¹ã¨ã‹ã„ã‚ã‚“ãªå·¥å¤«ãŒå¿…è¦ãã†ã€‚
- ã¾ãšã€ 2048 ãƒˆãƒ¼ã‚¯ãƒ³ã«ã©ã®ãã‚‰ã„ã®æƒ…å ±ã‚’è¼‰ã›ã‚‰ã‚Œã‚‹ã®ã‹ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€ã„ãã¤ã‹ã®é•·ã•ã®é•ã†æ–‡ç« ã‚’å…¥ã‚Œã¦ã¿ã¦ã€‚ã©ã®ç¨‹åº¦ã®ã‚‚ã®ãªã®ã‹æ„Ÿè¦šå€¤ã‚’æŽ´ã‚€ã€‚
  - é•·ã™ãŽã‚‹å ´åˆã€é©å½“ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç­‰é–“éš”ã§åˆ†å‰²ã—ã¦ã€ãã‚Œãžã‚Œæ–‡å­—æ•°æŒ‡å®šã§è¦ç´„ã•ã›ã¦ã€‚çŸ­æ–‡ã‚’çµ„ã¿åˆã‚ã›ã¦ã€å¤§æ„ã‚’æŽ¨ç§»ã•ã›ã‚‹ãªã©ã®æ‰‹æ³•ã‚’è©¦ã—ã¦ã¿ã‚‹
  - [research\_token\_length.py](../stablelm_sandbox/research_token_length.py) ã§ãƒˆãƒ¼ã‚¯ãƒ³ã”ã¨ã®æƒ…å ±é‡ã‚’èª¿ã¹ã‚‹ã€‚
  - ç°¡å˜ãªãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã‚’ä½œã£ã¦ã¿ã‚‹
    - ã¨ã‚Šã‚ãˆãš [prompt\_template](../prompt_template) ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å…¥ã‚Œã¦ã„ã“ã†
      - ã‚ã¨ã§ jinja2 ã‚’ä½¿ã†äºˆå®šãªã®ã§æ‹¡å¼µå­ã¯ j2 ã«ã—ã¨ã
    - [prompt\_template/000.j2](../prompt_template/000.j2) ã‚’ä½œã£ã¦è©¦ã—ã¦ã¿ãŸ
      - å…¨ç„¶ãƒ€ãƒ¡ã€ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã«å¾“ã†ã£ã¦ã„ã†æ°—ãŒå…¨ç„¶ãªã„
      - ã“ã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã†ã¨ã—ãŸã‚‰ã€æ–‡è„ˆä¸Šè‡ªç„¶ã«ç¾ã‚Œã‚‹ã‚ˆã†ãªãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã‚’ä½¿ã†ã—ã‹ãªã„ã€‚ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã™ã‚‹ãªã‚‰åˆ¥ã€‚
- ã¨ã‚Šã‚ãˆãšã€é•·ã„æ–‡ã‚’ç¹°ã‚Šè¿”ã™ã¨ T4 ã¯é™ç•Œã£ã½ã„ã®ã§ A100 40GB è©¦ã—ã¦ã¿ã‚ˆã†
  - ã ã‚“ã ã‚“ã¨ã‚³ã‚¹ãƒˆãŒä¸ŠãŒã£ã¦ãã¦ã´ãˆã‚“å‘³ãŒæ·±ã„ðŸ¥º
- æœ€åˆã®ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ãŒã‚ã¾ã‚Šã«ã‚‚ã´ãˆã‚“ã ã£ãŸã®ã§ã€æ—©ã€…ã«åˆ‡ã‚Šä¸Šã’ã¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’è¦–é‡Žã«å…¥ã‚ŒãŸèª¿æŸ»ã‚’ã—ãŸæ–¹ãŒã„ã„æ°—ã‚‚ã—ã¦ããŸãŒã©ã†ã™ã£ã¹ã‹ã€‚
- ã“ã®è¡Œã‚’æ›¸ã„ã¦ã„ã‚‹æ™‚ç‚¹ã§æ·±å¤œãªã®ã§ä»Šæ—¥ã¯ã‚‚ã†å¯ã‚‹ã‘ã©æ˜Žæ—¥ã¯ä»¥ä¸‹ã‚’ã‚„ã‚ŠãŸã„
  - ã¾ãš T4 ã˜ã‚ƒãƒ€ãƒ¡ãªã‚“ã§ A100 40GB ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‹ã‚‰ã‚„ã‚‹
  - AIã®ã¹ã‚Šã™ã¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç™ºè¦‹ã—ãŸã®ã§ AI ã®ã¹ã‚Šã™ã¨ã¨çµæžœã®æ¯”è¼ƒã—ãªãŒã‚‰ã€ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã«ç‰¹åŒ–ã—ãŸ train ãŒé‡è¦ã‹é‡è¦ã§ãªã„ã‹æ„Ÿè¦šã‚’å¾—ã‚‹
- T4 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å‰Šé™¤ã—ã¦ A100 40GB ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹
  - A100 40GB / a2-highgpu-1g / Ubuntu 22.04 / 100 GB SSD / ã‚¹ãƒãƒƒãƒˆãªæ„Ÿã˜ã§
    - ã‚³ãƒ¼ãƒ‰ã®æ›¸ãç›´ã—ãŒå¤šã„ã®ã§ weight ã®èª­ã¿è¾¼ã¿ãŒãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã«ãªã£ã¦ã‚‹ SSD ã«ã—ãŸã€‚ 100 GB ã§ã‚‚ 3000 IOPS å‰ã®ç’°å¢ƒã ã¨ 600 IOPS ã ã£ãŸ
    - 1.65 USD/hour
      - T4 ã§è©¦ã—ã¦ãŸã¨ãã® 5 å€ã®æ–™é‡‘
      - åœæ­¢å¿˜ã‚Œäº‹æ•…ãŒã‚ã£ãŸã¨ã
        - 1 day 6000 å††
        - 1 week 42000 å††
        - 1 month 168000 å††
    - æœã® 6:00 ãã‚‰ã„ã«èµ·å‹•ã—ã¦ãŸã‚‰çµ‚äº†ã™ã‚‹ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰æ›¸ã„ã¨ãã‹
      - `sudo timedatectl set-timezone Asia/Tokyo`
      - `sudo crontab -l > /tmp/current_cron`
      - `sudo sh -c 'echo "0 6 * * * /sbin/shutdown -h now" >> /tmp/current_cron'`
      - `sudo crontab /tmp/current_cron`
      - `sudo systemctl restart cron`
      - `sudo rm /tmp/current_cron`

